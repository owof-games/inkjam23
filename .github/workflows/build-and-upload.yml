on:
  workflow_call:
    inputs:
      version:
        required: false
        type: string
      project_name:
        required: true
        type: string
      excludes_windows:
        required: false
        type: boolean
        default: false
      excludes_linux:
        required: false
        type: boolean
        default: false
      excludes_macos:
        required: false
        type: boolean
        default: false
      excludes_webgl:
        required: false
        type: boolean
        default: false
    secrets:
      BUTLER_CREDENTIALS:
        required: true
      UNITY_LICENSE:
        required: true
      UNITY_EMAIL:
        required: true
      UNITY_PASSWORD:
        required: true
  
jobs:
  windows:
    if: ${{ !inputs.excludes_windows }}
    uses: ./.github/workflows/single-build-and-upload.yml
    with:
      project_name: ${{ inputs.project_name }}
      version: ${{ inputs.version }}
      tags: '["self-hosted", "Windows"]'
      name: Windows üóî
      targetPlatform: StandaloneWindows
      timeout: 15
      buildContinueOnError: true
      channel: win
    secrets:
      BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}
      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
      UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
      UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
  linux:
    if: ${{ !inputs.excludes_linux }}
    uses: ./.github/workflows/single-build-and-upload.yml
    with:
      project_name: ${{ inputs.project_name }}
      version: ${{ inputs.version }}
      tags: '["self-hosted", "Linux"]'
      name: Linux üêß
      targetPlatform: StandaloneLinux64
      timeout: 360
      buildContinueOnError: false
      channel: linux
    secrets:
      BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}
      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
      UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
      UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
  webgl:
    if: ${{ !inputs.excludes_webgl }}
    uses: ./.github/workflows/single-build-and-upload.yml
    with:
      project_name: ${{ inputs.project_name }}
      version: ${{ inputs.version }}
      tags: '["self-hosted", "Linux"]'
      name: WebGL üåê
      targetPlatform: WebGL
      timeout: 360
      buildContinueOnError: false
      channel: webgl
    secrets:
      BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}
      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
      UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
      UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
  macos:
    if: ${{ !inputs.excludes_macos }}
    uses: ./.github/workflows/single-build-and-upload.yml
    with:
      project_name: ${{ inputs.project_name }}
      version: ${{ inputs.version }}
      tags: '["macos-latest"]'
      name: MacOS üçè
      targetPlatform: StandaloneOSX
      timeout: 360
      buildContinueOnError: false
      channel: mac
    secrets:
      BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}
      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
      UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
      UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
